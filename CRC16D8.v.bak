//-----------------------------------------------------------------------------
// Copyright (C) 2009 OutputLogic.com 
// This source file may be used and distributed without restriction 
// provided that this copyright statement is not removed from the file 
// and that any derivative work contains the original copyright notice 
// and the associated disclaimer. 
// 
// THIS SOURCE FILE IS PROVIDED "AS IS" AND WITHOUT ANY EXPRESS 
// OR IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED	
// WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR A PARTICULAR PURPOSE. 
//-----------------------------------------------------------------------------
// CRC module for data[7:0] ,   crc[15:0]=1+x^5+x^12+x^16;
//-----------------------------------------------------------------------------
`timescale 1 ps/ 1 ps
	
module CRC16D8(
	input	[7:0] data,
	input	crcEn,
	input	rst,
	input	clk,
	output [15:0] crcOut);

	reg [15:0] crcReg;
	wire[15:0] nextCRC;

	assign crcOut = crcReg;

	always @(posedge clk, posedge rst) begin
		if(rst) begin
      crcReg <= {16{1'b1}};
		end
		else begin
			crcReg <= crcEn ? nextCRC : crcReg;
		end
	end 

	assign nextCRC[0] = crcReg[8] ^ crcReg[12] ^ data[7] ^ data[3];
	assign nextCRC[1] = crcReg[9] ^ crcReg[13] ^ data[6] ^ data[2];
	assign nextCRC[2] = crcReg[10] ^ crcReg[14] ^ data[5] ^ data[1];
	assign nextCRC[3] = crcReg[11] ^ crcReg[15] ^ data[4] ^ data[0];
	assign nextCRC[4] = crcReg[12] ^ data[3];
	assign nextCRC[5] = crcReg[8] ^ crcReg[12] ^ crcReg[13] ^ data[7] ^ data[3] ^ data[2];
	assign nextCRC[6] = crcReg[9] ^ crcReg[13] ^ crcReg[14] ^ data[6] ^ data[2] ^ data[1];
	assign nextCRC[7] = crcReg[10] ^ crcReg[14] ^ crcReg[15] ^ data[5] ^ data[1] ^ data[0];
	assign nextCRC[8] = crcReg[0] ^ crcReg[11] ^ crcReg[15] ^ data[4] ^ data[0];
	assign nextCRC[9] = crcReg[1] ^ crcReg[12] ^ data[3];
	assign nextCRC[10] = crcReg[2] ^ crcReg[13] ^ data[2];
	assign nextCRC[11] = crcReg[3] ^ crcReg[14] ^ data[1];
	assign nextCRC[12] = crcReg[4] ^ crcReg[8] ^ crcReg[12] ^ crcReg[15] ^ data[7] ^ data[3] ^ data[0];
	assign nextCRC[13] = crcReg[5] ^ crcReg[9] ^ crcReg[13] ^ data[6] ^ data[2];
	assign nextCRC[14] = crcReg[6] ^ crcReg[10] ^ crcReg[14] ^ data[5] ^ data[1];
	assign nextCRC[15] = crcReg[7] ^ crcReg[11] ^ crcReg[15] ^ data[4] ^ data[0];
endmodule